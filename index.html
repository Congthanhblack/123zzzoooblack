<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ƒê·ªá Nh·∫•t T·ª≠u V∆∞∆°ng - Ultra Compact</title>
    <style>
        :root { --bg: #0b0b0b; --card: #161616; --gold: #FFD700; --text: #fff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        
        body {
            background: var(--bg); color: var(--text);
            font-family: -apple-system, sans-serif;
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
            padding: 5px;
        }

        /* HEADER SI√äU G·ªåN */
        .header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 5px 10px; flex-shrink: 0;
        }
        h1 { color: var(--gold); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
        .fund-top { color: #2ecc71; font-weight: bold; font-size: 0.85rem; }

        /* V√ôNG CH√çNH - KH√îNG CU·ªòN */
        .main-stage {
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; flex: 0 0 75vh; /* Chi·∫øm t·ªëi ƒëa 75% chi·ªÅu cao m√†n h√¨nh */
        }

        .wheels-container {
            display: flex; justify-content: center; gap: 10px; 
            width: 100%; padding: 15px 0;
        }

        .wheel-wrapper {
            position: relative;
            width: 42vw; max-width: 160px; /* Thu nh·ªè h∆°n n·ªØa */
            aspect-ratio: 1/1;
        }

        canvas {
            width: 100% !important; height: 100% !important; border-radius: 50%;
            border: 2px solid #333; box-shadow: 0 0 10px rgba(0,0,0,0.8);
            transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1);
        }

        .pointer {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 16px; height: 22px; background: #fff;
            clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 10;
        }

        .wheel-label {
            position: absolute; bottom: -16px; width: 100%;
            text-align: center; color: var(--gold); font-size: 0.55rem; font-weight: bold;
        }

        /* K·∫æT QU·∫¢ & ƒêI·ªÄU KHI·ªÇN */
        #result-box {
            background: var(--card); border: 1px solid #333; border-radius: 8px;
            width: 95%; max-width: 380px; min-height: 60px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; margin: 10px 0; padding: 5px;
        }
        
        .res-highlight { color: #5dade2; font-weight: bold; font-size: 0.95rem; text-transform: uppercase; }
        .res-action { font-size: 0.95rem; color: #ec7063; font-weight: bold; }
        .res-funny { font-size: 0.7rem; color: #888; font-style: italic; }
        .farewell-msg { color: #ff69b4; font-size: 0.75rem; font-weight: bold; }

        #spinBtn {
            background: linear-gradient(135deg, #FFD700, #ff8c00);
            border: none; border-radius: 20px; padding: 10px 0;
            font-weight: 900; font-size: 0.9rem; cursor: pointer; width: 80%; max-width: 250px;
            box-shadow: 0 3px 10px rgba(255, 215, 0, 0.2);
        }

        .btn-group { display: flex; justify-content: center; gap: 5px; margin-top: 8px; }
        .btn-group button { 
            background: #222; color: #bbb; border: 1px solid #333; padding: 5px 10px; 
            border-radius: 12px; font-size: 0.65rem;
        }

        /* PH·∫¶N D∆Ø·ªöI - CU·ªòN ƒê∆Ø·ª¢C */
        .scroll-area {
            flex: 1; overflow-y: auto; margin-top: 10px;
            border-top: 1px solid #222; padding: 5px;
        }

        .info-card { background: #111; border-radius: 6px; padding: 8px; margin-bottom: 5px; border: 1px solid #1a1a1a; }
        h3 { font-size: 0.65rem; color: #555; margin-bottom: 3px; text-transform: uppercase; }
        .rank-item { display: flex; justify-content: space-between; font-size: 0.75rem; padding: 3px 0; border-bottom: 1px dashed #222; }
        #history-list { font-size: 0.7rem; color: #666; }
    </style>
</head>
<body>

    <div class="header">
        <h1>üçª ƒê·ªÜ NH·∫§T T·ª¨U V∆Ø∆†NG üçª</h1>
        <div class="fund-top">Qu·ªπ: <span id="fundAmount">200</span>k</div>
    </div>

    <div class="main-stage">
        <div class="wheels-container">
            <div class="wheel-wrapper">
                <div class="pointer"></div>
                <canvas id="canvasName"></canvas>
                <div class="wheel-label">AI L√Ä N·∫†N NH√ÇN?</div>
            </div>
            <div class="wheel-wrapper">
                <div class="pointer"></div>
                <canvas id="canvasGift"></canvas>
                <div class="wheel-label">S·ªê PH·∫¨N RA SAO?</div>
            </div>
        </div>

        <div id="result-box">
            <div class="res-funny">Nh·∫•n QUAY ƒë·ªÉ b·∫Øt ƒë·∫ßu ƒë·ªãnh ƒëo·∫°t!</div>
        </div>

        <div class="controls">
            <button id="spinBtn">QUAY NGAY üî•</button>
            <div class="btn-group">
                <button onclick="undoLast()">‚è™ Ho√†n t√°c</button>
                <button onclick="editFund()">üí∞ S·ª≠a qu·ªπ</button>
                <button style="color:#e74c3c" onclick="resetGame()">üßπ Reset</button>
            </div>
        </div>
    </div>

    <div class="scroll-area">
        <div class="info-card">
            <h3>üèÜ B·∫¢NG PHONG TH·∫¶N</h3>
            <div id="rankList"></div>
        </div>
        <div class="info-card">
            <h3>üìú NH·∫¨T K√ù CHI·∫æN TR∆Ø·ªúNG</h3>
            <div id="history-list">Ch∆∞a c√≥ d·ªØ li·ªáu...</div>
        </div>
    </div>

<script>
    const names = ["NCT", "A Qu·∫£", "C. Lan", "A Thi", "E Chinh", "E H√≤a", "E An", "E Ch∆∞∆°ng", "S∆°n", "Thao", "KM 1", "KM 2"];
    const males = ["NCT", "A Qu·∫£", "A Thi", "E An", "E Ch∆∞∆°ng", "S∆°n", "Thao", "KM 1", "KM 2"];
    const gifts = [
        { label: "U·ªëng 1 ch√©n", color: "#e74c3c", val: 1, wM: 35, wF: 10, fun: "C·∫°n ly v√¨ t√¨nh huynh ƒë·ªá! üç∫" },
        { label: "U·ªëng 2 ch√©n", color: "#c0392b", val: 2, wM: 15, wF: 5,  fun: "H·∫£o t·ª≠u l∆∞·ª£ng! üòà" },
        { label: "U·ªëng 1/2", color: "#e67e22", val: 0.5, wM: 5, wF: 30, fun: "Nh·∫•p m√¥i l·∫•y l·ªá. üòâ" },
        { label: "U·ªëng h·ªô", color: "#1abc9c", val: 0, wM: 10, wF: 10, fun: "Huynh mu·ªën h·∫°i ai? üëâ" },
        { label: "Full ly ‚ò†Ô∏è", color: "#8e44ad", val: 2, wM: 10, wF: 2,  fun: "D·ª©t ƒëi·ªÉm 100%! ü§Æ" },
        { label: "Ch·ªâ ƒë·ªãnh", color: "#9b59b6", val: 0, wM: 8, wF: 8,  fun: "Quy·ªÅn sinh s√°t! üó°Ô∏è" },
        { label: "G√≥p 10k", color: "#f39c12", money: -10, val: 0, wM: 5, wF: 5, fun: "Ting ting v√†o qu·ªπ! üí∏" },
        { label: "G√≥p 20k", color: "#f1c40f", money: -20, val: 0, wM: 5, wF: 5, fun: "ƒê·∫°i gia xu·∫•t hi·ªán! üëè" },
        { label: "Qua l∆∞·ª£t", color: "#3498db", val: 0, wM: 5, wF: 15, fun: "May m·∫Øn tho√°t n·∫°n üôè" },
        { label: "1 Phi·∫øu ƒê·ªïi", color: "#2ecc71", val: 0, wM: 5, wF: 10, fun: "Kim b√†i mi·ªÖn t·ª≠ üõ°Ô∏è" }
    ];

    let fund = 200, drinkStats = {}, historyLog = [], lastAction = null, isSpinning = false, secretCount = 0, forceHoa = false, hasHoaDone = false, rotName = 0, rotGift = 0;
    names.forEach(n => drinkStats[n] = 0);

    function drawWheel(id, items) {
        const cvs = document.getElementById(id), ctx = cvs.getContext('2d'), count = items.length, arc = (Math.PI*2)/count;
        cvs.width = 400; cvs.height = 400;
        items.forEach((item, i) => {
            const angle = i * arc; ctx.beginPath(); ctx.fillStyle = (typeof item === 'string') ? (i % 2 === 0 ? '#1c2833' : '#273746') : item.color;
            ctx.moveTo(200, 200); ctx.arc(200, 200, 195, angle, angle + arc); ctx.fill();
            ctx.save(); ctx.translate(200, 200); ctx.rotate(angle + arc/2); ctx.textAlign = "right"; ctx.fillStyle = "#fff"; ctx.font = "bold 20px Arial"; ctx.fillText(typeof item === 'string' ? item : item.label, 185, 8); ctx.restore();
        });
    }

    function spin() {
        if(isSpinning) return; isSpinning = true; document.getElementById('spinBtn').disabled = true; secretCount = 0;
        document.getElementById('result-box').innerHTML = "üåÄ ƒêang ch·ªçn n·∫°n nh√¢n...";
        let nIdx = (forceHoa && !hasHoaDone) ? names.indexOf("E H√≤a") : Math.floor(Math.random()*names.length);
        const pName = names[nIdx], isM = males.includes(pName);
        
        let totalW = 0; gifts.forEach(g => totalW += isM ? g.wM : g.wF);
        let r = Math.random() * totalW, gift = gifts[0];
        for (let g of gifts) { let w = isM ? g.wM : g.wF; if (r < w) { gift = g; break; } r -= w; }
        const gIdx = gifts.indexOf(gift);

        rotName += (360*5) + (270 - (nIdx*(360/names.length) + (360/names.length)/2) - (rotName%360) + 360)%360;
        rotGift += (360*7) + (270 - (gIdx*(360/gifts.length) + (360/gifts.length)/2) - (rotGift%360) + 360)%360;
        document.getElementById('canvasName').style.transform = `rotate(${rotName}deg)`;
        document.getElementById('canvasGift').style.transform = `rotate(${rotGift}deg)`;

        setTimeout(() => {
            if (forceHoa && nIdx === names.indexOf("E H√≤a")) {
                document.getElementById('result-box').innerHTML = `<div class="res-highlight" style="color:#ff69b4">${pName} ‚ù§Ô∏è</div><div class="farewell-msg">Ch√∫c em lu√¥n xinh ƒë·∫πp v√† r·∫°ng r·ª°! ‚ú®</div>`;
                hasHoaDone = true; forceHoa = false; lastAction = { type: 'FAREWELL' };
            } else {
                drinkStats[pName] += gift.val; fund += (gift.money || 0);
                document.getElementById('result-box').innerHTML = `<div class="res-highlight">${pName}</div><div class="res-action">${gift.label}</div><div class="res-funny">${gift.fun}</div>`;
                historyLog.unshift(`${pName}: ${gift.label}`); lastAction = { name: pName, drink: gift.val, money: (gift.money || 0) };
            }
            updateUI(); isSpinning = false; document.getElementById('spinBtn').disabled = false;
        }, 5100);
    }

    function updateUI() {
        document.getElementById('fundAmount').innerText = fund;
        const sorted = Object.entries(drinkStats).sort((a,b) => b[1]-a[1]);
        document.getElementById('rankList').innerHTML = sorted.slice(0,5).map(i => `<div class="rank-item"><span>${i[0]}</span><b>${i[1]} ch√©n</b></div>`).join('');
        document.getElementById('history-list').innerHTML = historyLog.slice(0,10).map(h => `<div>‚Ä¢ ${h}</div>`).join('');
    }

    function resetGame() {
        if(!confirm("Reset?")) { secretCount = 0; return; }
        secretCount++;
        if(secretCount === 4 && !hasHoaDone) {
            forceHoa = true; secretCount = 0;
            document.getElementById('result-box').innerHTML = "<div style='color:var(--gold);font-weight:bold'>Gi√≥ ƒë√£ ƒë·ªïi chi·ªÅu... üå¨Ô∏è</div>";
        } else {
            fund = 200; historyLog = []; names.forEach(n => drinkStats[n]=0); updateUI();
            document.getElementById('result-box').innerHTML = "<div>ƒê√£ l√†m m·ªõi!</div>";
        }
    }

    function undoLast() { if(lastAction && confirm("Undo?")) { if(lastAction.type!=='FAREWELL'){ drinkStats[lastAction.name]-=lastAction.drink; fund-=lastAction.money; } else hasHoaDone=false; historyLog.shift(); lastAction=null; updateUI(); } }
    function editFund() { let n = prompt("S·ªë ti·ªÅn:", fund); if(n!==null) { fund=parseInt(n); updateUI(); } }
    window.onload = () => { drawWheel('canvasName', names); drawWheel('canvasGift', gifts); updateUI(); document.getElementById('spinBtn').onclick = spin; };
</script>
</body>
</html>
