<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>T·ª≠u V∆∞∆°ng V6 - Chu·∫©n Qu·ªπ</title>
    <style>
        :root {
            --bg-color: #0d0d12;
            --card-bg: #16161e;
            --gold: #ffcc00;
            --red: #ff4757;
            --green: #2ed573;
            --text-color: #eee;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            overflow: hidden; /* Ch·∫∑n cu·ªôn tuy·ªát ƒë·ªëi */
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* HEADER & QU·ª∏ */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid #333;
            height: 40px;
        }

        h1 {
            color: var(--gold);
            font-size: 1rem;
            margin: 0;
            text-transform: uppercase;
        }

        .fund-box {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .fund-value { color: var(--green); }

        /* KHU V·ª∞C CH√çNH - LAYOUT NGANG */
        .main-stage {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 0 10px;
            position: relative;
        }

        .wheel-container {
            position: relative;
            /* D√πng vmin ƒë·ªÉ h√¨nh tr√≤n lu√¥n v·ª´a kh√≠t m√†n h√¨nh b·∫•t k·ªÉ xoay d·ªçc hay ngang */
            width: 45vmin; 
            height: 45vmin;
            max-width: 350px;
            max-height: 350px;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.2);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: transform 4.5s cubic-bezier(0.1, 0, 0.1, 1);
        }

        .pointer {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 30px;
            background: #fff;
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 10;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        .wheel-title {
            position: absolute;
            bottom: -25px;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: #888;
            font-weight: bold;
        }

        /* B·∫¢NG ƒêI·ªÄU KHI·ªÇN D∆Ø·ªöI */
        .control-panel {
            padding: 10px;
            background: #111;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 20;
        }

        #result-display {
            text-align: center;
            font-size: 1.1rem;
            min-height: 1.5em;
            color: var(--gold);
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
        }

        .action-row {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        button {
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-weight: bold;
            cursor: pointer;
            color: #fff;
            font-size: 0.9rem;
        }

        .btn-spin {
            background: linear-gradient(135deg, #e67e22, #f1c40f);
            color: #000;
            flex: 2;
            font-size: 1.1rem;
            text-transform: uppercase;
        }
        .btn-spin:active { transform: scale(0.98); }
        .btn-spin:disabled { opacity: 0.5; filter: grayscale(1); }

        .btn-small { background: #333; flex: 1; border: 1px solid #444; }

        /* MODAL (B·∫£ng ƒëi·ªÉm) */
        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--gold);
        }
        .close-btn { float: right; cursor: pointer; font-size: 1.5rem; color: #888; }

    </style>
</head>
<body>

    <div class="top-bar">
        <h1>üç∫ V6 LOGIC</h1>
        <div class="fund-box">QU·ª∏: <span id="fundAmount" class="fund-value">0</span> K</div>
    </div>

    <div class="main-stage">
        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="canvasName"></canvas>
            <div class="wheel-title">NG∆Ø·ªúI CH∆†I</div>
        </div>

        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="canvasGift"></canvas>
            <div class="wheel-title">TH·ª¨ TH√ÅCH</div>
        </div>
    </div>

    <div class="control-panel">
        <div id="result-display">S·∫µn s√†ng...</div>
        
        <div class="action-row">
            <button class="btn-small" onclick="toggleStats()">üìä B·∫£ng ƒêi·ªÉm</button>
            <button class="btn-spin" id="spinBtn">QUAY NGAY</button>
            <button class="btn-small" onclick="undoLast()">‚è™ Ho√†n T√°c</button>
        </div>
    </div>

    <div id="statsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="toggleStats()">&times;</span>
            <h3 style="color:var(--gold); margin-top:0">üèÜ B·∫¢NG PHONG TH·∫¶N</h3>
            <div id="rankList"></div>
            <hr style="border-color:#333">
            <button class="btn-small" style="width:100%" onclick="editFund()">üí∞ S·ª≠a Qu·ªπ</button>
            <br><br>
            <button class="btn-small" style="width:100%" onclick="editNames()">üë• ƒê·ªïi Ng∆∞·ªùi Ch∆°i</button>
        </div>
    </div>

<script>
    // --- C·∫§U H√åNH ---
    let names = ["NCT", "A Qu·∫£", "C. Lan", "A Thi", "E Chinh", "E H√≤a", "S∆°n", "Thao"];
    
    // Logic qu·ªπ: 
    // fundChange > 0: G√≥p v√†o (Qu·ªπ tƒÉng)
    // fundChange < 0: L√¨ x√¨ (Qu·ªπ gi·∫£m)
    const gifts = [
        { label: "1 ch√©n", color: "#e74c3c", val: 1, fundChange: 0 },
        { label: "2 ch√©n", color: "#c0392b", val: 2, fundChange: 0 },
        { label: "1/2 ly", color: "#e67e22", val: 0.5, fundChange: 0 },
        { label: "U·ªëng h·ªô", color: "#1abc9c", val: 0, fundChange: 0 },
        { label: "G√≥p 10k", color: "#f1c40f", val: 0, fundChange: 10 }, // C·ªông v√†o qu·ªπ
        { label: "G√≥p 20k", color: "#f39c12", val: 0, fundChange: 20 }, // C·ªông v√†o qu·ªπ
        { label: "L√¨ x√¨ 20k", color: "#2ed573", val: 0, fundChange: -20 }, // Tr·ª´ qu·ªπ
        { label: "Qua l∆∞·ª£t", color: "#3498db", val: 0, fundChange: 0 }
    ];

    let fund = 200; // Qu·ªπ kh·ªüi ƒëi·ªÉm 200k
    let drinkStats = {};
    let lastAction = null;
    let rotName = 0, rotGift = 0, isSpinning = false;

    // --- H√ÄM V·∫º ---
    function drawWheel(canvasId, items) {
        const canvas = document.getElementById(canvasId);
        const ctx = canvas.getContext('2d');
        const count = items.length;
        const arc = (2 * Math.PI) / count;
        // ƒê·ªô ph√¢n gi·∫£i cao
        canvas.width = 600; canvas.height = 600; 
        
        items.forEach((item, i) => {
            const angle = i * arc;
            ctx.beginPath();
            ctx.fillStyle = (typeof item === 'string') ? (i % 2 === 0 ? '#1e1e2e' : '#282838') : item.color;
            ctx.moveTo(300, 300);
            ctx.arc(300, 300, 295, angle, angle + arc);
            ctx.fill();
            ctx.strokeStyle = "rgba(0,0,0,0.2)";
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.save();
            ctx.translate(300, 300);
            ctx.rotate(angle + arc / 2);
            ctx.textAlign = "right";
            ctx.fillStyle = "#fff";
            ctx.font = "bold 32px Arial";
            ctx.shadowColor = "rgba(0,0,0,0.8)";
            ctx.shadowBlur = 4;
            
            let text = typeof item === 'string' ? item : item.label;
            // R√∫t g·ªçn text n·∫øu qu√° d√†i
            if(text.includes("L√¨ x√¨")) text = "L√¨ x√¨";
            if(text.includes("G√≥p")) text = text.replace("G√≥p", "+");
            
            ctx.fillText(text, 260, 10);
            ctx.restore();
        });
    }

    // --- LOGIC QUAY ---
    function spin() {
        if(isSpinning) return;
        isSpinning = true;
        document.getElementById('spinBtn').disabled = true;
        document.getElementById('result-display').innerHTML = "üé≤ ƒêang quay...";
        document.getElementById('result-display').style.color = "#888";

        // Random g√≥c quay (th√™m √≠t nh·∫•t 5 v√≤ng)
        rotName += Math.floor(Math.random() * 360) + 1800; 
        rotGift += Math.floor(Math.random() * 360) + 1800;

        document.getElementById('canvasName').style.transform = `rotate(${rotName}deg)`;
        document.getElementById('canvasGift').style.transform = `rotate(${rotGift}deg)`;

        // ƒê·ª£i 4.5s
        setTimeout(showResult, 4600);
    }

    function showResult() {
        // T√≠nh to√°n v·ªã tr√≠ m≈©i t√™n (g√≥c 270 ƒë·ªô l√† v·ªã tr√≠ kim ch·ªâ)
        const nIdx = Math.floor(((360 - (rotName % 360) + 270) % 360) / (360 / names.length));
        const gIdx = Math.floor(((360 - (rotGift % 360) + 270) % 360) / (360 / gifts.length));
        
        const pName = names[nIdx];
        const pGift = gifts[gIdx];

        // C·∫≠p nh·∫≠t d·ªØ li·ªáu
        if(!drinkStats[pName]) drinkStats[pName] = 0;
        drinkStats[pName] += pGift.val;
        
        fund += pGift.fundChange; // C·ªông ho·∫∑c Tr·ª´ qu·ªπ theo logic m·ªõi
        if(fund < 0) fund = 0; // Kh√¥ng ƒë·ªÉ qu·ªπ √¢m

        // L∆∞u l·ªãch s·ª≠ ƒë·ªÉ ho√†n t√°c
        lastAction = { 
            name: pName, 
            drink: pGift.val, 
            fundChange: pGift.fundChange,
            label: pGift.label
        };

        // Hi·ªÉn th·ªã k·∫øt qu·∫£
        let actionText = pGift.label;
        let color = pGift.color;
        
        // Th√™m icon cho sinh ƒë·ªông
        if(pGift.fundChange > 0) actionText += " üí∏ (Qu·ªπ tƒÉng)";
        if(pGift.fundChange < 0) actionText += " üßß (Qu·ªπ gi·∫£m)";

        document.getElementById('result-display').innerHTML = `${pName} ‚ûî <span style="color:${color}">${actionText}</span>`;
        
        updateUI();
        isSpinning = false;
        document.getElementById('spinBtn').disabled = false;
    }

    // --- C√ÅC H√ÄM PH·ª§ TR·ª¢ ---
    function updateUI() {
        document.getElementById('fundAmount').innerText = fund;
        
        // Render b·∫£ng x·∫øp h·∫°ng
        const sorted = Object.entries(drinkStats).sort((a,b) => b[1] - a[1]);
        const html = sorted.map((item, i) => 
            `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #333">
                <span>${i+1}. ${item[0]}</span>
                <span style="color:var(--gold)">${item[1]} ch√©n</span>
            </div>`
        ).join('');
        document.getElementById('rankList').innerHTML = html || "<p>Ch∆∞a ai u·ªëng...</p>";
    }

    function undoLast() {
        if(!lastAction) return alert("Kh√¥ng c√≥ g√¨ ƒë·ªÉ ho√†n t√°c!");
        if(confirm(`H·ªßy k·∫øt qu·∫£: ${lastAction.name} - ${lastAction.label}?`)) {
            drinkStats[lastAction.name] -= lastAction.drink;
            fund -= lastAction.fundChange; // ƒê·∫£o ng∆∞·ª£c logic ti·ªÅn (n·∫øu c·ªông th√¨ gi·ªù tr·ª´, n·∫øu tr·ª´ th√¨ gi·ªù c·ªông)
            lastAction = null;
            document.getElementById('result-display').innerText = "ƒê√£ ho√†n t√°c!";
            updateUI();
        }
    }

    function editFund() {
        let val = prompt("Nh·∫≠p s·ªë ti·ªÅn qu·ªπ hi·ªán t·∫°i (k):", fund);
        if(val && !isNaN(val)) { fund = parseInt(val); updateUI(); }
    }

    function editNames() {
        let val = prompt("Nh·∫≠p t√™n, c√°ch nhau d·∫•u ph·∫©y:", names.join(","));
        if(val) { 
            names = val.split(",").filter(x=>x).map(x=>x.trim()); 
            drawWheel('canvasName', names);
            drinkStats = {}; // Reset ƒëi·ªÉm khi ƒë·ªïi ng∆∞·ªùi
            names.forEach(n => drinkStats[n] = 0);
            updateUI();
        }
    }

    function toggleStats() {
        const m = document.getElementById('statsModal');
        m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
    }

    // --- KH·ªûI CH·∫†Y ---
    window.onload = () => {
        names.forEach(n => drinkStats[n] = 0);
        drawWheel('canvasName', names);
        drawWheel('canvasGift', gifts);
        updateUI();
        document.getElementById('spinBtn').onclick = spin;
    };
</script>
</body>
</html>
