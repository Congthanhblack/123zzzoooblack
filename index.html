<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ƒê·ªá Nh·∫•t T·ª≠u V∆∞∆°ng - Pro Max</title>
    <style>
        :root { --gold: #ffde00; --red: #e74c3c; --blue: #3498db; }
        body { background: #0d0d0d; color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        h1 { color: var(--gold); font-size: 1.4rem; text-transform: uppercase; margin: 15px 0; text-shadow: 0 0 10px rgba(255,222,0,.5); text-align: center; }
        
        .info-bar { display: flex; gap: 20px; margin-bottom: 10px; font-weight: bold; font-size: 0.9rem; color: #ccc; }
        #fund-display { color: var(--gold); }

        .container { display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; }
        .wheel-box { position: relative; width: 300px; height: 300px; }
        canvas { width: 100%; height: 100%; border-radius: 50%; border: 4px solid #fff; transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); background: #222; }
        
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 30px; height: 35px; background: #fff; clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 10; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5)); }
        .label { margin-top: 8px; color: var(--gold); font-weight: bold; font-size: 0.8rem; text-transform: uppercase; }

        #result-display { margin-top: 20px; background: #1a1a1a; border: 1px solid #333; width: 85%; max-width: 450px; padding: 15px; border-radius: 12px; text-align: center; min-height: 70px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .res-name { color: var(--blue); font-size: 1.4rem; font-weight: bold; }
        .res-gift { color: var(--red); font-size: 1.6rem; font-weight: bold; margin-top: 5px; }

        .controls { display: flex; gap: 10px; margin: 20px 0; }
        #spinBtn { background: linear-gradient(180deg, var(--gold), #e6c200); color: #000; border: none; padding: 12px 40px; font-size: 1.1rem; font-weight: bold; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 15px rgba(255, 222, 0, 0.3); }
        #spinBtn:disabled { background: #444; color: #888; box-shadow: none; }
        
        #history { width: 85%; max-width: 450px; margin-top: 10px; font-size: 0.8rem; color: #888; border-top: 1px solid #333; padding-top: 10px; height: 100px; overflow-y: auto; }
        @media(min-width: 768px){ .container { flex-direction: row; justify-content: center; } }
    </style>
</head>
<body>

<h1>üçª ƒê·ªÜ NH·∫§T T·ª¨U V∆Ø∆†NG üçª</h1>

<div class="info-bar">
    <span>Qu·ªπ c√≤n l·∫°i: <span id="fund-display">200,000</span>ƒë</span>
</div>

<div class="container">
    <div class="wheel-box">
        <div class="pointer"></div>
        <canvas id="canvasName"></canvas>
        <div class="label">N·∫°n nh√¢n</div>
    </div>
    <div class="wheel-box">
        <div class="pointer"></div>
        <canvas id="canvasGift"></canvas>
        <div class="label">S·ªë ph·∫≠n</div>
    </div>
</div>

<div id="result-display"><div id="status-text">S·∫µn s√†ng! Nh·∫•n QUAY ƒë·ªÉ b·∫Øt ƒë·∫ßu.</div></div>

<div class="controls">
    <button id="spinBtn">QUAY NGAY</button>
</div>

<div id="history"><b>L·ªãch s·ª≠:</b></div>

<script>
// C·∫•u h√¨nh d·ªØ li·ªáu
const names = ["NCT", "A Qu·∫£", "C. Lan", "A Thi", "E Chinh", "E H√≤a", "E An", "E Ch∆∞∆°ng", "S∆°n", "Thao", "KM 1", "KM 2"];
let gifts = [
    { label: "L√¨ x√¨ 20k", color: "#f1c40f", value: 20000, prob: 5 },
    { label: "U·ªëng 1 ch√©n", color: "#e74c3c", value: 0, prob: 20 },
    { label: "Qua l∆∞·ª£t", color: "#3498db", value: 0, prob: 15 },
    { label: "L√¨ x√¨ 10k", color: "#f39c12", value: 10000, prob: 10 },
    { label: "Ch·ªâ ƒë·ªãnh", color: "#8e44ad", value: 0, prob: 10 },
    { label: "U·ªëng 2 ch√©n", color: "#c0392b", value: 0, prob: 10 },
    { label: "U·ªëng 1/2", color: "#e67e22", value: 0, prob: 15 },
    { label: "U·ªëng ch√©o", color: "#16a085", value: 0, prob: 10 }, // M·ªõi
    { label: "C·∫£ b√†n u·ªëng", color: "#95a5a6", value: 0, prob: 5 }   // M·ªõi
];

let remainingFund = 200000;
let isSpinning = false;
let rotName = 0, rotGift = 0;

function drawWheel(id, items) {
    const canvas = document.getElementById(id);
    const ctx = canvas.getContext('2d');
    const num = items.length;
    const arc = (Math.PI * 2) / num;
    canvas.width = 600; canvas.height = 600;

    items.forEach((item, i) => {
        const angle = i * arc;
        // V·∫Ω mi·∫øng b√°nh
        ctx.beginPath();
        ctx.fillStyle = typeof item === "string" ? (i % 2 ? "#2c3e50" : "#34495e") : item.color;
        ctx.moveTo(300, 300);
        ctx.arc(300, 300, 290, angle, angle + arc);
        ctx.lineTo(300, 300);
        ctx.fill();
        ctx.strokeStyle = "rgba(255,255,255,0.2)";
        ctx.stroke();

        // V·∫Ω ch·ªØ (ƒê√£ s·ª≠a l·ªói l·ªách)
        ctx.save();
        ctx.translate(300, 300);
        ctx.rotate(angle + arc / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#fff";
        const text = typeof item === "string" ? item : item.label;
        ctx.font = text.length > 8 ? "bold 20px Arial" : "bold 26px Arial";
        ctx.fillText(text, 270, 10);
        ctx.restore();
    });
}

function pickWeightedItem(items) {
    const totalProb = items.reduce((sum, item) => sum + item.prob, 0);
    let random = Math.random() * totalProb;
    for (let item of items) {
        if (random < item.prob) return item;
        random -= item.prob;
    }
    return items[0];
}

const btn = document.getElementById('spinBtn');
const display = document.getElementById('result-display');
const fundText = document.getElementById('fund-display');
const historyBox = document.getElementById('history');

function spin() {
    if (isSpinning) return;
    isSpinning = true;
    btn.disabled = true;
    display.innerHTML = "ƒêang quay...";

    // 1. Ch·ªçn k·∫øt qu·∫£ tr∆∞·ªõc
    const winnerNameIdx = Math.floor(Math.random() * names.length);
    let winnerGift = pickWeightedItem(gifts);

    // Ki·ªÉm tra qu·ªπ ti·ªÅn
    if (winnerGift.value > remainingFund) {
        winnerGift = { ...winnerGift, label: "H·∫øt ti·ªÅn -> U·ªëng!", value: 0 };
    }

    // 2. T√≠nh to√°n g√≥c quay ƒë·ªÉ m≈©i t√™n ch·ªâ ƒë√∫ng √¥ ƒë√≥
    // V√≤ng quay Canvas b·∫Øt ƒë·∫ßu t·ª´ 3h (0 rad), m≈©i t√™n ·ªü 12h (270 ƒë·ªô)
    const nameArc = 360 / names.length;
    const giftArc = 360 / gifts.length;

    const targetNameDeg = 270 - (winnerNameIdx * nameArc + nameArc / 2);
    const targetGiftDeg = 270 - (gifts.indexOf(gifts.find(g => g.label === winnerGift.label)) * giftArc + giftArc / 2);

    // C·ªông th√™m nhi·ªÅu v√≤ng ƒë·ªÉ quay ƒë·∫πp
    rotName += (360 * 5) + (targetNameDeg - (rotName % 360) + 360) % 360;
    rotGift += (360 * 8) + (targetGiftDeg - (rotGift % 360) + 360) % 360;

    document.getElementById('canvasName').style.transform = `rotate(${rotName}deg)`;
    document.getElementById('canvasGift').style.transform = `rotate(${rotGift}deg)`;

    setTimeout(() => {
        // C·∫≠p nh·∫≠t qu·ªπ ti·ªÅn
        if (winnerGift.value > 0) {
            remainingFund -= winnerGift.value;
            fundText.innerText = remainingFund.toLocaleString();
        }

        // Hi·ªÉn th·ªã k·∫øt qu·∫£
        display.innerHTML = `<div class="res-name">${names[winnerNameIdx]}</div>
                             <div style="color:#888; font-size:0.8rem">nh·∫≠n ngay</div>
                             <div class="res-gift">${winnerGift.label}</div>`;
        
        // L∆∞u l·ªãch s·ª≠
        const log = document.createElement('div');
        log.innerHTML = `‚Ä¢ <b>${names[winnerNameIdx]}</b>: ${winnerGift.label}`;
        historyBox.prepend(log);

        isSpinning = false;
        btn.disabled = false;
        if (navigator.vibrate) navigator.vibrate(200);
    }, 5100);
}

// Kh·ªüi t·∫°o
document.addEventListener('DOMContentLoaded', () => {
    drawWheel('canvasName', names);
    drawWheel('canvasGift', gifts);
});

btn.onclick = spin;
</script>
</body>
</html>
