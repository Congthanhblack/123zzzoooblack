<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T·ª≠u V∆∞∆°ng V10 - B·∫£n Chu·∫©n</title>
    <style>
        :root {
            --gold: #ffcc00; --bg: #0f0f13; --card: #1c1c24; --text: #eee;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg); color: var(--text);
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0; padding: 0;
            height: 100dvh; /* S·ª≠ d·ª•ng dvh ƒë·ªÉ kh·ªõp ch√≠nh x√°c m√†n h√¨nh ƒëi·ªán tho·∫°i */
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* 1. HEADER G·ªåN NH·∫§T C√ì TH·ªÇ */
        header {
            flex: 0 0 auto;
            padding: 5px 15px; background: #1a1a20;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333;
        }
        header h1 { font-size: 0.9rem; margin: 0; color: var(--gold); }
        .fund-box { font-weight: bold; color: #2ed573; font-size: 1rem; }

        /* 2. KHU V·ª∞C V√íNG QUAY - ƒê·∫®Y L√äN CAO */
        .stage {
            flex: 1 1 auto;
            display: flex; justify-content: center; align-items: flex-start;
            padding-top: 10px; gap: 8px;
        }
        .wheel-wrap {
            position: relative;
            width: 47vw; max-width: 38vh; /* Thu nh·ªè h∆°n m·ªôt ch√∫t ƒë·ªÉ ch·ª´a ch·ªó cho n√∫t */
            aspect-ratio: 1/1;
        }
        canvas {
            width: 100%; height: 100%; border-radius: 50%;
            border: 2px solid #444;
            transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1);
        }
        .pointer {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 26px; background: #fff;
            clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 10;
        }
        .tag {
            position: absolute; bottom: -18px; width: 100%;
            text-align: center; font-size: 0.7rem; color: #888; font-weight: bold;
        }

        /* 3. KHU V·ª∞C ƒêI·ªÄU KHI·ªÇN - ƒê·∫¢M B·∫¢O LU√îN TH·∫§Y */
        .controls {
            flex: 0 0 auto;
            background: var(--card);
            padding: 10px 15px;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; gap: 8px;
        }

        #intro-txt { text-align: center; font-size: 0.8rem; color: #aaa; font-style: italic; min-height: 1.1rem; }
        
        #result-box {
            text-align: center; min-height: 45px;
            display: flex; flex-direction: column; justify-content: center;
        }
        .res-main { font-weight: 800; font-size: 1.1rem; color: var(--gold); }
        .res-joke { font-size: 0.75rem; color: #888; margin-top: 2px; }

        .btn-main {
            background: linear-gradient(135deg, #ffcc00, #f39c12);
            border: none; padding: 14px; border-radius: 10px;
            color: #000; font-weight: bold; font-size: 1.1rem;
            width: 100%; box-shadow: 0 4px 0 #a36200;
        }
        .btn-main:active { transform: translateY(2px); box-shadow: 0 2px 0 #a36200; }
        .btn-main:disabled { filter: grayscale(1); opacity: 0.5; }

        .btn-row { display: flex; gap: 8px; }
        .btn-sub {
            flex: 1; background: #333; border: 1px solid #444; color: #ccc;
            padding: 8px; border-radius: 6px; font-size: 0.8rem;
        }

        /* POPUP */
        .modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            z-index: 100; align-items: center; justify-content: center;
        }
        .modal-content {
            background: var(--card); padding: 20px; border-radius: 12px;
            width: 85%; max-width: 320px; border: 1px solid var(--gold);
        }
    </style>
</head>
<body>

    <header>
        <h1>V10 - NH√ÇN PH·∫®M V∆Ø∆†NG</h1>
        <div class="fund-box">QU·ª∏: <span id="fund">200</span>K</div>
    </header>

    <div class="stage">
        <div class="wheel-wrap">
            <div class="pointer"></div>
            <canvas id="cvName"></canvas>
            <div class="tag">AI TI·∫æP THEO?</div>
        </div>
        <div class="wheel-wrap">
            <div class="pointer"></div>
            <canvas id="cvGift"></canvas>
            <div class="tag">S·ªê PH·∫¨N</div>
        </div>
    </div>

    <div class="controls">
        <div id="intro-txt">"ƒê√¢y l√† v√≤ng quay nh√¢n ph·∫©m, b·∫°n t·ª± tin ch·ª©?"</div>
        
        <div id="result-box">
            <div class="res-main" id="resText">S·∫µn s√†ng nh·∫≠p ti·ªác!</div>
            <div class="res-joke" id="resJoke"></div>
        </div>

        <button class="btn-main" id="spinBtn">üî• QUAY NGAY üî•</button>
        
        <div class="btn-row">
            <button class="btn-sub" onclick="toggleMenu()">üìä B·∫£ng ƒëi·ªÉm</button>
            <button class="btn-sub" onclick="undo()">‚è™ Ho√†n t√°c</button>
        </div>
    </div>

    <div id="menuModal" class="modal">
        <div class="modal-content">
            <h3 style="text-align:center; color:var(--gold); margin-top:0">C√ÄI ƒê·∫∂T</h3>
            <div id="rankings" style="max-height:150px; overflow-y:auto; margin-bottom:15px; font-size:0.9rem"></div>
            <button class="btn-sub" style="width:100%; margin-bottom:8px" onclick="editPlayers()">ƒê·ªïi ng∆∞·ªùi ch∆°i</button>
            <button class="btn-sub" style="width:100%; margin-bottom:8px" onclick="editFund()">S·ª≠a ti·ªÅn qu·ªπ</button>
            <button class="btn-main" style="width:100%; font-size:0.9rem" onclick="toggleMenu()">ƒê√ìNG</button>
        </div>
    </div>

<script>
    // --- C·∫§U H√åNH D·ªÆ LI·ªÜU ---
    let names = ["NCT", "A Qu·∫£", "C. Lan", "A Thi", "E Chinh", "E H√≤a", "S∆°n", "Thao"];
    const gifts = [
        { label: "1 Ch√©n", color: "#e74c3c", val: 1, fund: 0, weight: 8 },
        { label: "2 Ch√©n", color: "#c0392b", val: 2, fund: 0, weight: 4 },
        { label: "50% Ly", color: "#e67e22", val: 0.5, fund: 0, weight: 5 },
        { label: "Ch·ªâ ƒë·ªãnh", color: "#9b59b6", val: 0, fund: 0, weight: 3 },
        { label: "G√≥p 20k", color: "#f1c40f", val: 0, fund: 20, weight: 2 },
        { label: "L√¨ x√¨ 10k", color: "#2ecc71", val: 0, fund: -10, weight: 2 },
        { label: "L√¨ x√¨ 20k", color: "#27ae60", val: 0, fund: -20, weight: 1 },
        { label: "Qua l∆∞·ª£t", color: "#3498db", val: 0, fund: 0, weight: 2 }
    ];

    const drinkJokes = [
        "R∆∞·ª£u b·∫•t kh·∫£ √©p, nh∆∞ng √©p th√¨ ph·∫£i u·ªëng!",
        "T·ª≠u l∆∞·ª£ng l√† do tr·ªùi ph√∫, c√≤n u·ªëng l√† do s·ªë ƒëen.",
        "ƒê·ª´ng tr√°ch v√≤ng quay, h√£y tr√°ch b√†n tay b·∫°n quay.",
        "B·∫£n lƒ©nh n·∫±m ·ªü ƒë√°y ly, c·ªë l√™n anh em!",
        "M·ªôt ch√©n n√†y, c·∫£ b√†n ghi c√¥ng!"
    ];
    const introQuotes = [
        "V√≤ng quay nh√¢n ph·∫©m, b·∫°n c√≥ t·ª± tin...?",
        "Ai run tay th√¨ xin m·ªùi ra ngo√†i!",
        "V√≤ng quay kh√¥ng n√≥i d·ªëi, ch·ªâ c√≥ ng∆∞·ªùi say m·ªõi n√≥i d·ªëi!",
        "ƒê·ª´ng nh√¨n t√¥i, h√£y nh√¨n v√†o ƒë·ªãnh m·ªánh c·ªßa b·∫°n."
    ];

    let fund = 200, drinkStats = {}, nameBag = [], giftBag = [], rotN = 0, rotG = 0, lastLog = null;

    // --- THU·∫¨T TO√ÅN T√öI (BAG) ---
    function fillBags() {
        nameBag = []; names.forEach(n => { nameBag.push(n); nameBag.push(n); });
        giftBag = []; gifts.forEach(g => { for(let i=0; i<g.weight; i++) giftBag.push(g); });
        nameBag.sort(() => Math.random() - 0.5);
        giftBag.sort(() => Math.random() - 0.5);
    }

    // --- GAME LOGIC ---
    function spin() {
        const btn = document.getElementById('spinBtn');
        if(btn.disabled) return;
        btn.disabled = true;

        if(!nameBag.length || !giftBag.length) fillBags();
        
        const targetName = nameBag.pop();
        const targetGift = giftBag.pop();

        const nIdx = names.indexOf(targetName);
        const gIdx = gifts.findIndex(g => g.label === targetGift.label);
        const nSlice = 360/names.length, gSlice = 360/gifts.length;

        // Quay √≠t nh·∫•t 6 v√≤ng
        rotN = (rotN - (rotN%360)) + 2160 + (270 - (nIdx*nSlice) - nSlice/2);
        rotG = (rotG - (rotG%360)) + 2160 + (270 - (gIdx*gSlice) - gSlice/2);

        document.getElementById('cvName').style.transform = `rotate(${rotN}deg)`;
        document.getElementById('cvGift').style.transform = `rotate(${rotG}deg)`;
        document.getElementById('intro-txt').innerText = "üåÄ S·ªë ph·∫≠n ƒëang ƒë∆∞·ª£c quy·∫øt ƒë·ªãnh...";

        setTimeout(() => {
            if(targetGift.val > 0) drinkStats[targetName] += targetGift.val;
            fund += targetGift.fund; if(fund < 0) fund = 0;
            
            lastLog = { name: targetName, gift: targetGift };
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ & C√¢u n√≥i h√†i h∆∞·ªõc
            let joke = "";
            if(targetGift.val > 0) joke = drinkJokes[Math.floor(Math.random()*drinkJokes.length)];
            else if(targetGift.fund > 0) joke = "Ti·ªÅn l√† ph√π du, n·ªôp qu·ªπ l√† nghƒ©a v·ª•!";
            else if(targetGift.fund < 0) joke = "Nh√¢n ph·∫©m ƒë·∫°i b·ªôc ph√°t! L√¨ x√¨ v·ªÅ t√∫i.";
            else joke = "Tho√°t n·∫°n ngo·∫°n m·ª•c!";

            document.getElementById('resText').innerHTML = `${targetName} ‚ûî <span style="color:${targetGift.color}">${targetGift.label}</span>`;
            document.getElementById('resJoke').innerText = `"${joke}"`;
            document.getElementById('intro-txt').innerText = introQuotes[Math.floor(Math.random()*introQuotes.length)];
            
            updateUI();
            btn.disabled = false;
        }, 4100);
    }

    // --- UI HELPERS ---
    function draw(id, items) {
        const cv = document.getElementById(id);
        const ctx = cv.getContext('2d');
        const count = items.length; const arc = 2*Math.PI/count;
        cv.width = 600; cv.height = 600;
        items.forEach((it, i) => {
            const ang = i*arc;
            ctx.beginPath(); ctx.moveTo(300, 300); ctx.arc(300,300,295, ang, ang+arc);
            ctx.fillStyle = (typeof it === 'string') ? (i%2?'#1c1c24':'#252530') : it.color;
            ctx.fill(); ctx.strokeStyle = "#444"; ctx.stroke();
            ctx.save(); ctx.translate(300, 300); ctx.rotate(ang + arc/2);
            ctx.textAlign="right"; ctx.fillStyle="#fff"; ctx.font="bold 32px Arial";
            let txt = (typeof it === 'string') ? it : it.label;
            if(txt.includes("L√¨ x√¨")) txt = txt.replace("L√¨ x√¨ ","+");
            if(txt.includes("G√≥p")) txt = "-20k";
            ctx.fillText(txt, 270, 10); ctx.restore();
        });
    }

    function updateUI() {
        document.getElementById('fund').innerText = fund;
        let html = "";
        Object.entries(drinkStats).sort((a,b)=>b[1]-a[1]).forEach(([n,v],i) => {
            html += `<div style="display:flex;justify-content:space-between;padding:6px;border-bottom:1px solid #333">
                <span>${i+1}. ${n}</span> <span style="color:var(--gold)">${v} ch√©n</span>
            </div>`;
        });
        document.getElementById('rankings').innerHTML = html || "Ch∆∞a c√≥ ai u·ªëng...";
    }

    function toggleMenu() { 
        const m = document.getElementById('menuModal');
        m.style.display = (m.style.display === 'flex') ? 'none' : 'flex';
    }

    function undo() {
        if(!lastLog) return;
        if(confirm(`H·ªßy k·∫øt qu·∫£: ${lastLog.name}?`)) {
            if(lastLog.gift.val > 0) drinkStats[lastLog.name] -= lastLog.gift.val;
            fund -= lastLog.gift.fund;
            nameBag.push(lastLog.name); giftBag.push(lastLog.gift); // Tr·∫£ l·∫°i t√∫i
            lastLog = null; updateUI();
            document.getElementById('resText').innerText = "ƒê√£ ho√†n t√°c!";
        }
    }

    function editPlayers() {
        let v = prompt("Nh·∫≠p t√™n c√°c anh em (ph·∫©y):", names.join(","));
        if(v) { names = v.split(",").map(x=>x.trim()).filter(x=>x); init(); }
    }
    function editFund() {
        let v = prompt("Nh·∫≠p s·ªë ti·ªÅn qu·ªπ hi·ªán t·∫°i:", fund);
        if(v) { fund = parseInt(v); updateUI(); }
    }

    function init() {
        names.forEach(n => { if(!drinkStats[n]) drinkStats[n] = 0; });
        fillBags();
        draw('cvName', names);
        draw('cvGift', gifts);
        updateUI();
    }

    window.onload = () => {
        init();
        document.getElementById('spinBtn').onclick = spin;
    };
</script>
</body>
</html>
