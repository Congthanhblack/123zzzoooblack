<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ƒê·ªá Nh·∫•t T·ª≠u V∆∞∆°ng - v4 Reset Edition</title>
    <style>
        :root { --bg: #0b0b0b; --card: #161616; --gold: #FFD700; --text: #fff; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg); color: var(--text);
            font-family: -apple-system, sans-serif; margin: 0; padding: 5px;
            display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }

        h1 { color: var(--gold); text-align: center; font-size: 1.1rem; margin: 5px 0; text-transform: uppercase; letter-spacing: 1px; }

        .main-stage { flex-shrink: 0; display: flex; flex-direction: column; align-items: center; }

        .wheels-container {
            display: flex; justify-content: center; gap: 8px; padding: 10px 0 20px 0;
        }

        .wheel-wrapper {
            position: relative;
            width: 45vw; max-width: 170px;
            aspect-ratio: 1/1;
        }

        canvas {
            width: 100% !important; height: 100% !important; border-radius: 50%;
            border: 2px solid #444; box-shadow: 0 0 15px rgba(0,0,0,0.8);
            transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1);
        }

        .pointer {
            position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
            width: 18px; height: 24px; background: #fff;
            clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 10;
        }

        .wheel-label {
            position: absolute; bottom: -18px; width: 100%;
            text-align: center; color: var(--gold); font-size: 0.6rem; font-weight: bold;
        }

        #result-box {
            background: var(--card); border: 1.5px solid #333;
            border-radius: 8px; padding: 8px; margin: 10px 0;
            width: 95%; max-width: 400px; min-height: 65px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        
        .res-highlight { color: #5dade2; font-weight: bold; font-size: 1rem; text-transform: uppercase; }
        .res-action { font-size: 1rem; color: #ec7063; font-weight: bold; margin-top: 2px; }
        .res-funny { font-size: 0.75rem; color: #888; font-style: italic; }
        .farewell-msg { color: #ff69b4; font-size: 0.8rem; font-weight: bold; line-height: 1.2; }

        .controls { width: 100%; text-align: center; }
        #spinBtn {
            background: linear-gradient(135deg, #FFD700, #ff8c00);
            border: none; border-radius: 25px; padding: 12px 0;
            font-weight: 900; font-size: 1rem; cursor: pointer; width: 85%; max-width: 280px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-group { display: flex; justify-content: center; gap: 6px; margin-top: 10px; }
        .btn-group button { 
            background: #222; color: #bbb; border: 1px solid #333; padding: 6px 12px; 
            border-radius: 15px; font-size: 0.7rem; font-weight: bold;
        }
        .btn-group .danger { border-color: #500; color: #e74c3c; }

        .scroll-area {
            flex: 1; overflow-y: auto; margin-top: 12px;
            padding: 5px; border-top: 1px solid #222;
        }

        .info-card { background: #111; border-radius: 6px; padding: 8px; margin-bottom: 8px; border: 1px solid #1a1a1a; }
        h3 { font-size: 0.7rem; color: #555; margin: 0 0 5px 0; text-transform: uppercase; display: flex; justify-content: space-between; }
        .rank-item { display: flex; justify-content: space-between; font-size: 0.8rem; padding: 4px 0; border-bottom: 1px dashed #222; }
        #history-list { font-size: 0.75rem; color: #666; line-height: 1.4; }
    </style>
</head>
<body>

    <h1>üçª ƒê·ªÜ NH·∫§T T·ª¨U V∆Ø∆†NG üçª</h1>

    <div class="main-stage">
        <div class="wheels-container">
            <div class="wheel-wrapper">
                <div class="pointer"></div>
                <canvas id="canvasName"></canvas>
                <div class="wheel-label">AI L√Ä N·∫†N NH√ÇN?</div>
            </div>
            <div class="wheel-wrapper">
                <div class="pointer"></div>
                <canvas id="canvasGift"></canvas>
                <div class="wheel-label">S·ªê PH·∫¨N RA SAO?</div>
            </div>
        </div>

        <div id="result-box">
            <div class="res-funny">Nh·∫•n n√∫t QUAY ƒë·ªÉ b·∫Øt ƒë·∫ßu ƒë·ªãnh ƒëo·∫°t!</div>
        </div>

        <div class="controls">
            <button id="spinBtn">QUAY NGAY üî•</button>
            <div class="btn-group">
                <button onclick="undoLast()">‚è™ Ho√†n t√°c</button>
                <button onclick="editFund()">üí∞ Qu·ªπ</button>
                <button class="danger" onclick="resetGame()">üßπ Reset</button>
            </div>
        </div>
    </div>

    <div class="scroll-area">
        <div class="info-card">
            <h3><span>üèÜ B·∫¢NG PHONG TH·∫¶N</span> <span style="color:#2ecc71">Qu·ªπ: <span id="fundAmount">200</span>k</span></h3>
            <div id="rankList"></div>
        </div>
        <div class="info-card">
            <h3>üìú NH·∫¨T K√ù CHI·∫æN TR∆Ø·ªúNG</h3>
            <div id="history-list">Ch∆∞a c√≥ d·ªØ li·ªáu...</div>
        </div>
    </div>

<script>
    const names = ["NCT", "A Qu·∫£", "C. Lan", "A Thi", "E Chinh", "E H√≤a", "E An", "E Ch∆∞∆°ng", "S∆°n", "Thao", "KM 1", "KM 2"];
    const males = ["NCT", "A Qu·∫£", "A Thi", "E An", "E Ch∆∞∆°ng", "S∆°n", "Thao", "KM 1", "KM 2"];

    const gifts = [
        { label: "U·ªëng 1 ch√©n", color: "#e74c3c", val: 1, wM: 35, wF: 10, fun: "C·∫°n ly v√¨ t√¨nh anh em! üç∫" },
        { label: "U·ªëng 2 ch√©n", color: "#c0392b", val: 2, wM: 15, wF: 5,  fun: "T·ª≠u l∆∞·ª£ng v√¥ song! üòà" },
        { label: "U·ªëng 1/2", color: "#e67e22", val: 0.5, wM: 5, wF: 30, fun: "Nh·∫•p m√¥i l√†m duy√™n th√¥i. üòâ" },
        { label: "U·ªëng h·ªô", color: "#1abc9c", val: 0, wM: 10, wF: 10, fun: "Mu·ªën h·∫°i ai th√¨ n√≥i ƒëi! üëâ" },
        { label: "Full ly ‚ò†Ô∏è", color: "#8e44ad", val: 2, wM: 10, wF: 2,  fun: "TrƒÉm ph·∫ßn trƒÉm kh√¥ng ch·ª´a! ü§Æ" },
        { label: "Ch·ªâ ƒë·ªãnh", color: "#9b59b6", val: 0, wM: 8, wF: 8,  fun: "Quy·ªÅn sinh s√°t trong tay! üó°Ô∏è" },
        { label: "G√≥p 10k", color: "#f39c12", money: -10, val: 0, wM: 5, wF: 5, fun: "Ting ting! V√†o qu·ªπ 10k. üí∏" },
        { label: "G√≥p 20k", color: "#f1c40f", money: -20, val: 0, wM: 5, wF: 5, fun: "ƒê·∫°i gia ƒë√¢y r·ªìi! G√≥p 20k. üëè" },
        { label: "Qua l∆∞·ª£t", color: "#3498db", val: 0, wM: 5, wF: 15, fun: "Th·∫ßn men ƒë√£ ƒë·ªô b·∫°n! üôè" },
        { label: "1 Phi·∫øu ƒê·ªïi", color: "#2ecc71", val: 0, wM: 5, wF: 10, fun: "Kim b√†i mi·ªÖn t·ª≠! üõ°Ô∏è" }
    ];

    let fund = 200, drinkStats = {}, historyLog = [], lastAction = null, isSpinning = false;
    let secretCount = 0, forceHoa = false, hasHoaDone = false;
    let rotName = 0, rotGift = 0;

    names.forEach(n => drinkStats[n] = 0);

    function drawWheel(id, items) {
        const cvs = document.getElementById(id), ctx = cvs.getContext('2d');
        const count = items.length, arc = (Math.PI*2)/count, size = 500;
        cvs.width = size; cvs.height = size;
        items.forEach((item, i) => {
            const angle = i * arc;
            ctx.beginPath(); ctx.fillStyle = (typeof item === 'string') ? (i % 2 === 0 ? '#1c2833' : '#273746') : item.color;
            ctx.moveTo(250, 250); ctx.arc(250, 250, 245, angle, angle + arc); ctx.fill();
            ctx.save(); ctx.translate(250, 250); ctx.rotate(angle + arc/2);
            ctx.textAlign = "right"; ctx.fillStyle = "#fff"; ctx.font = "bold 24px Arial";
            ctx.fillText(typeof item === 'string' ? item : item.label, 230, 10); ctx.restore();
        });
    }

    function getWeightedGift(isMale) {
        let total = 0;
        gifts.forEach(g => total += isMale ? g.wM : g.wF);
        let r = Math.random() * total;
        for (let g of gifts) {
            let w = isMale ? g.wM : g.wF;
            if (r < w) return g;
            r -= w;
        }
        return gifts[0];
    }

    function spin() {
        if(isSpinning) return;
        isSpinning = true; document.getElementById('spinBtn').disabled = true;
        secretCount = 0; 
        document.getElementById('result-box').innerHTML = "üåÄ ƒêang tri·ªáu h·ªìi n·∫°n nh√¢n...";

        let isFarewell = false;
        let nIdx;

        if (forceHoa && !hasHoaDone) {
            nIdx = names.indexOf("E H√≤a");
            isFarewell = true; forceHoa = false; hasHoaDone = true;
        } else {
            nIdx = Math.floor(Math.random()*names.length);
        }

        const pName = names[nIdx];
        const gift = getWeightedGift(males.includes(pName));
        const gIdx = gifts.indexOf(gift);

        rotName += (360*5) + (270 - (nIdx*(360/names.length) + (360/names.length)/2) - (rotName%360) + 360)%360;
        rotGift += (360*7) + (270 - (gIdx*(360/gifts.length) + (360/gifts.length)/2) - (rotGift%360) + 360)%360;

        document.getElementById('canvasName').style.transform = `rotate(${rotName}deg)`;
        document.getElementById('canvasGift').style.transform = `rotate(${rotGift}deg)`;

        setTimeout(() => {
            if (isFarewell) {
                document.getElementById('result-box').innerHTML = `
                    <div class="res-highlight" style="color:#ff69b4">${pName} ‚ù§Ô∏è</div>
                    <div class="farewell-msg">Ch√∫c em lu√¥n xinh ƒë·∫πp v√† r·ª±c r·ª° tr√™n ch·∫∑ng ƒë∆∞·ªùng m·ªõi nh√©! ‚ú®</div>
                    <div style="font-size:0.7rem; color:#2ecc71; margin-top:3px">ƒê·∫∑c quy·ªÅn: Em ch·ªçn 1 ng∆∞·ªùi l√†m 1 vi·ªác gi√∫p em!</div>
                `;
                historyLog.unshift(`${pName}: L·ªùi ch√∫c chia tay ‚ù§Ô∏è`);
                lastAction = { type: 'FAREWELL' };
            } else {
                drinkStats[pName] += gift.val; fund += (gift.money || 0);
                document.getElementById('result-box').innerHTML = `
                    <div class="res-highlight">${pName}</div>
                    <div class="res-action">${gift.label}</div>
                    <div class="res-funny">${gift.fun}</div>
                `;
                historyLog.unshift(`${pName}: ${gift.label}`);
                lastAction = { name: pName, drink: gift.val, money: (gift.money || 0) };
            }
            updateUI(); isSpinning = false; document.getElementById('spinBtn').disabled = false;
        }, 5100);
    }

    function updateUI() {
        document.getElementById('fundAmount').innerText = fund;
        const sorted = Object.entries(drinkStats).sort((a,b) => b[1]-a[1]);
        document.getElementById('rankList').innerHTML = sorted.slice(0,5).map(i => `<div class="rank-item"><span>${i[0]}</span><b>${i[1]} ch√©n</b></div>`).join('');
        document.getElementById('history-list').innerHTML = historyLog.slice(0,10).map(h => `<div>‚Ä¢ ${h}</div>`).join('');
    }

    function resetGame() {
        if(!confirm("D·ªçn b√†n l√†m l·∫°i t·ª´ ƒë·∫ßu?")) { secretCount = 0; return; }
        secretCount++;
        // C·∫¨P NH·∫¨T: THAY ƒê·ªîI T·ª™ 3 L·∫¶N TH√ÄNH 4 L·∫¶N RESET
        if(secretCount === 4 && !hasHoaDone) {
            forceHoa = true; secretCount = 0;
            document.getElementById('result-box').innerHTML = "<div style='color:var(--gold); font-weight:bold'>Gi√≥ ƒë√£ ƒë·ªïi chi·ªÅu... üå¨Ô∏è</div><div class='res-funny'>V·∫≠n m·ªánh l∆∞·ª£t t·ªõi ƒë√£ ƒë∆∞·ª£c an b√†i!</div>";
        } else {
            document.getElementById('result-box').innerHTML = "<div>ƒê·∫°i h·ªôi ƒë√£ l√†m m·ªõi!</div>";
            fund = 200; historyLog = []; names.forEach(n => drinkStats[n]=0); updateUI();
        }
    }

    function undoLast() { 
        if(!lastAction || !confirm("Ho√†n t√°c l∆∞·ª£t v·ª´a r·ªìi?")) return;
        if(lastAction.type !== 'FAREWELL') {
            drinkStats[lastAction.name] -= lastAction.drink;
            fund -= lastAction.money;
        } else { hasHoaDone = false; }
        historyLog.shift(); lastAction = null; updateUI();
    }

    function editFund() { 
        let n = prompt("Nh·∫≠p s·ªë qu·ªπ m·ªõi (K):", fund); 
        if(n !== null && !isNaN(n)) { fund = parseInt(n); updateUI(); }
    }

    window.onload = () => { 
        drawWheel('canvasName', names); 
        drawWheel('canvasGift', gifts); 
        updateUI(); 
        document.getElementById('spinBtn').onclick = spin; 
    };
</script>
</body>
</html>
