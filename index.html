<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Äá»‡ Nháº¥t Tá»­u VÆ°Æ¡ng â€“ Party Mode v3</title>
<style>
body{background:#111;color:#fff;font-family:"Comic Sans MS",Segoe UI,Tahoma;margin:0;text-align:center}
h1{color:#ffde00;margin:10px 0;text-shadow:0 0 10px rgba(255,222,0,.6)}
.container{display:flex;flex-wrap:wrap;justify-content:center;gap:20px}
.wheel-box{position:relative;width:280px}
canvas{width:100%;border-radius:50%;border:4px solid #fff;transition:transform 5s cubic-bezier(.1,0,.1,1)}
.pointer{position:absolute;top:-10px;left:50%;transform:translateX(-50%);
width:30px;height:30px;background:white;clip-path:polygon(50% 100%,0 0,100% 0)}
.label{margin-top:6px;color:#ffde00;font-weight:bold}
button{margin:6px;background:#ffde00;padding:10px 20px;border:none;
border-radius:30px;font-size:1rem;font-weight:bold;cursor:pointer}
button:disabled{background:#444;color:#777}
.box{border:1px solid #333;border-radius:12px;padding:8px;margin:6px auto;
max-width:500px;background:#1b1b1b}
.scroll{max-height:140px;overflow-y:auto;font-size:.9rem;text-align:left}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:4px}
</style>
</head>
<body>

<h1>ğŸ¤ªğŸ» Äá»† NHáº¤T Tá»¬U VÆ¯Æ NG â€“ PARTY MODE ğŸ»ğŸ¤ª</h1>

<div class="container">
  <div class="wheel-box">
    <div class="pointer"></div>
    <canvas id="canvasName"></canvas>
    <div class="label">ğŸ¯ Ai Xui Nháº¥t BÃ n?</div>
  </div>
  <div class="wheel-box">
    <div class="pointer"></div>
    <canvas id="canvasGift"></canvas>
    <div class="label">ğŸº Sá»‘ Pháº­n PhÃ¡n XÃ©t!</div>
  </div>
</div>

<button id="spinBtn">QUAY NGAY ğŸ”¥</button>
<button onclick="undoLast()">âª HoÃ n tÃ¡c</button>
<button onclick="editFund()">ğŸ’° Sá»­a quá»¹</button>

<div class="box">ğŸ’° Quá»¹ cÃ²n láº¡i: <span id="fundAmount">200</span>k</div>
<div class="box" id="result">Sáºµn sÃ ng quáº©y!</div>

<div class="box">
<h3>ğŸ“œ Lá»‹ch sá»­ drama</h3>
<div id="history" class="scroll two-col"></div>
</div>

<div class="box">
<h3>ğŸ† VUA Uá»NG â€“ VUA SAY â€“ TRÃ™M SÃ“NG GIÃ“</h3>
<div id="rank" class="scroll"></div>
<div id="totalDrink"></div>
</div>

<script>
let names=["NCT","A Quáº£","C. Lan","A Thi","E Chinh","E HÃ²a","E An","E ChÆ°Æ¡ng","SÆ¡n","Thao"];
let gifts=[
{label:"Uá»‘ng 1 chÃ©n",color:"#e74c3c"},
{label:"Uá»‘ng 2 chÃ©n",color:"#c0392b"},
{label:"Uá»‘ng 1/2",color:"#e67e22"},
{label:"Uá»‘ng há»™",color:"#1abc9c"},
{label:"Full ly ğŸ¤¢",color:"#9b59b6"},
{label:"Chá»‰ Ä‘á»‹nh 2 ngÆ°á»i",color:"#8e44ad"},
{label:"LÃ¬ xÃ¬ 10k",color:"#f39c12"},
{label:"LÃ¬ xÃ¬ 20k",color:"#f1c40f"},
{label:"Qua lÆ°á»£t",color:"#3498db"}
];

let rotN=0,rotG=0,isSpin=false;
let fund=200;
let history=[];
let drinkCount={},lastAction=null;

names.forEach(n=>drinkCount[n]=0);

function draw(id,items){
const c=document.getElementById(id),ctx=c.getContext("2d");
c.width=c.height=500;
let arc=2*Math.PI/items.length;
items.forEach((it,i)=>{
let a=i*arc;
ctx.beginPath();
ctx.fillStyle=typeof it==="string"?(i%2?"#34495e":"#2c3e50"):it.color;
ctx.moveTo(250,250);
ctx.arc(250,250,240,a,a+arc);
ctx.fill();
ctx.save();
ctx.translate(250,250);
ctx.rotate(a+arc/2);
ctx.textAlign="right";
ctx.fillStyle="#fff";
ctx.font="bold 20px Comic Sans MS";
ctx.fillText(typeof it==="string"?it:it.label,220,10);
ctx.restore();
});
}

function getIdx(rot,count){
let deg=rot%360;
return Math.floor(((360-deg+270)%360)/(360/count));
}

function startSpin(){
if(isSpin)return;
isSpin=true;spinBtn.disabled=true;
let addN=Math.random()*360+2160;
let addG=Math.random()*360+2880;
rotN+=addN;rotG+=addG;
canvasName.style.transform=`rotate(${rotN}deg)`;
canvasGift.style.transform=`rotate(${rotG}deg)`;
setTimeout(()=>{
let ni=getIdx(rotN,names.length);
let gi=getIdx(rotG,gifts.length);
let name=names[ni],gift=gifts[gi].label;
let addDrink=0,addFund=0;

if(gift.includes("1 chÃ©n"))addDrink=1;
if(gift.includes("2 chÃ©n"))addDrink=2;
if(gift.includes("1/2"))addDrink=0.5;
if(gift.includes("Full"))addDrink=2;
if(gift.includes("Uá»‘ng há»™")){
  let target=prompt("ğŸ˜ˆ Báº¡n chá»n ai uá»‘ng há»™? Nháº­p tÃªn:");
  if(target && drinkCount[target]!=null){
    name=target;
    addDrink=1;
  }
}
if(gift.includes("10k"))addFund=-10;
if(gift.includes("20k"))addFund=-20;

lastAction={name,gift,addDrink,addFund};

drinkCount[name]+=addDrink;
fund+=addFund;if(fund<0)fund=0;
fundAmount.textContent=fund;

history.unshift(`ğŸ¤£ ${name} lÃ£nh Ã¡n: <b>${gift}</b>`);
if(history.length>50)history.pop();

render();
isSpin=false;spinBtn.disabled=false;
},5100);
}

function render(){
result.innerHTML=`<b>${lastAction.name}</b> nháº­n <b>${lastAction.gift}</b>`;
historyBox.innerHTML=history.map(h=>`<div>${h}</div>`).join("");
renderRank();
}

function renderRank(){
let arr=Object.entries(drinkCount).sort((a,b)=>b[1]-a[1]);
rank.innerHTML=arr.map(([n,v],i)=>
`<div>${i+1}. <b>${n}</b> â€“ ${v} chÃ©n ${v>=8?"ğŸ¥´":v>=5?"ğŸ¤ª":""}</div>`).join("");
let total=arr.reduce((s,[,v])=>s+v,0);
totalDrink.innerHTML=`ğŸ“Š Tá»•ng cáº£ bÃ n: <b>${total}</b> chÃ©n`;
}

function undoLast(){
if(!lastAction)return alert("ChÆ°a cÃ³ lÆ°á»£t Ä‘á»ƒ hoÃ n tÃ¡c");
let {name,addDrink,addFund}=lastAction;
drinkCount[name]-=addDrink;
fund-=addFund;
fundAmount.textContent=fund;
history.shift();
lastAction=null;
render();
}

function editFund(){
let v=prompt("Nháº­p quá»¹ hiá»‡n táº¡i (nghÃ¬n):",fund);
let n=parseInt(v);
if(!isNaN(n)&&n>=0){fund=n;fundAmount.textContent=fund;}
}

spinBtn.onclick=startSpin;
const spinBtn=document.getElementById("spinBtn");
const canvasName=document.getElementById("canvasName");
const canvasGift=document.getElementById("canvasGift");
const fundAmount=document.getElementById("fundAmount");
const historyBox=document.getElementById("history");
const result=document.getElementById("result");
const rank=document.getElementById("rank");
const totalDrink=document.getElementById("totalDrink");

draw("canvasName",names);
draw("canvasGift",gifts);
</script>

</body>
</html>
