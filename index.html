<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T·ª≠u V∆∞∆°ng V9 - V√≤ng Quay Nh√¢n Ph·∫©m</title>
    <style>
        :root {
            --bg: #0a0a0c;
            --panel: #161b22;
            --gold: #ffcc00;
            --red: #ff4d4d;
            --green: #00e676;
            --text: #ffffff;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* HEADER */
        .header {
            flex: 0 0 auto;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1f242d;
            border-bottom: 2px solid var(--gold);
        }
        .fund-box {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--green);
            text-shadow: 0 0 5px rgba(0,230,118,0.3);
        }

        /* STAGE - ƒê·∫®Y L√äN TR√äN */
        .stage {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 15px;
            gap: 12px;
        }

        .wheel-container {
            position: relative;
            width: 46vw;
            max-width: 42vh;
            aspect-ratio: 1/1;
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid #30363d;
            transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1);
        }

        .pointer {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 26px;
            height: 35px;
            background: #fff;
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 10;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
        }

        .wheel-label {
            position: absolute;
            bottom: -22px;
            width: 100%;
            text-align: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: #8b949e;
            text-transform: uppercase;
        }

        /* CONTROL PANEL */
        .controls {
            flex: 0 0 auto;
            background: var(--panel);
            padding: 15px;
            border-radius: 20px 20px 0 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        /* KHU V·ª∞C D·∫™N CHUY·ªÜN H√ÄI H∆Ø·ªöC */
        #intro-text {
            text-align: center;
            font-style: italic;
            font-size: 0.85rem;
            color: #8b949e;
            min-height: 1.2em;
        }

        #result-display {
            text-align: center;
            min-height: 3.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .res-name { font-size: 1.2rem; font-weight: 800; color: var(--gold); }
        .res-gift { font-size: 1.1rem; font-weight: bold; color: var(--red); }
        .res-joke { font-size: 0.8rem; color: #aaa; margin-top: 4px; }

        .btn-main {
            background: linear-gradient(145deg, #ffca28, #ff8f00);
            border: none;
            padding: 14px;
            border-radius: 12px;
            color: #000;
            font-weight: 900;
            font-size: 1.1rem;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(255,143,0,0.3);
        }
        .btn-main:active { transform: scale(0.96); }
        .btn-main:disabled { filter: grayscale(1); opacity: 0.5; }

        .btn-row { display: flex; gap: 8px; }
        .btn-sub {
            flex: 1;
            background: #30363d;
            border: 1px solid #444;
            color: #c9d1d9;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* MODAL */
        .modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            z-index: 100; align-items: center; justify-content: center;
        }
        .modal-content {
            background: #161b22; padding: 20px; border-radius: 15px;
            width: 80%; border: 1px solid var(--gold);
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>üçª NH√ÇN PH·∫®M V9</h1>
        <div class="fund-box">QU·ª∏: <span id="fundVal">200</span>K</div>
    </div>

    <div class="stage">
        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="cvName"></canvas>
            <div class="wheel-label">K·∫ª b·ªã ch·ªçn</div>
        </div>
        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="cvGift"></canvas>
            <div class="wheel-label">ƒê·ªãnh m·ªánh</div>
        </div>
    </div>

    <div class="controls">
        <div id="intro-text">"ƒêang ki·ªÉm tra nh√¢n ph·∫©m c·ªßa b·∫°n..."</div>
        
        <div id="result-display">
            <div style="color:#666">Ch·∫°m ƒë·ªÉ th√°ch th·ª©c s·ªë ph·∫≠n!</div>
        </div>

        <button class="btn-main" id="spinBtn">üî• KHAI H·ªéA üî•</button>
        
        <div class="btn-row">
            <button class="btn-sub" onclick="toggleMenu()">üìä B·∫£ng ƒëi·ªÉm</button>
            <button class="btn-sub" onclick="undo()">‚Ü© Ho√†n t√°c</button>
        </div>
    </div>

    <div id="menuModal" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold); text-align:center">B·∫¢NG PHONG TH·∫¶N</h3>
            <div id="ranking" style="max-height:200px; overflow-y:auto; margin-bottom:15px"></div>
            <button class="btn-sub" style="width:100%; margin-bottom:8px" onclick="editPlayers()">ƒê·ªïi t√™n</button>
            <button class="btn-main" style="width:100%; font-size:0.9rem" onclick="toggleMenu()">ƒê√ìNG</button>
        </div>
    </div>

<script>
    // --- D·ªÆ LI·ªÜU ---
    let names = ["NCT", "A Qu·∫£", "C. Lan", "A Thi", "E Chinh", "E H√≤a", "S∆°n", "Thao"];
    const gifts = [
        { label: "1 Ch√©n", color: "#e74c3c", val: 1, fund: 0, weight: 8 },
        { label: "2 Ch√©n", color: "#c0392b", val: 2, fund: 0, weight: 4 },
        { label: "50% Ly", color: "#e67e22", val: 0.5, fund: 0, weight: 6 },
        { label: "Qua L∆∞·ª£t", color: "#3498db", val: 0, fund: 0, weight: 2 },
        { label: "Ch·ªâ ƒê·ªãnh", color: "#9b59b6", val: 0, fund: 0, weight: 3 },
        { label: "L√¨ X√¨ 20k", color: "#2ed573", val: 0, fund: -20, weight: 1 },
        { label: "G√≥p 20k", color: "#f1c40f", val: 0, fund: 20, weight: 2 }
    ];

    const introJokes = [
        "ƒê·ª´ng nh√¨n t√¥i, h√£y nh√¨n v√†o nh√¢n ph·∫©m c·ªßa b·∫°n!",
        "Ai run tay th√¨ xin m·ªùi ra ngo√†i...",
        "V√≤ng quay kh√¥ng n√≥i d·ªëi, ch·ªâ c√≥ ng∆∞·ªùi u·ªëng l√† say!",
        "Chu·∫©n b·ªã tinh th·∫ßn ƒëi, t·ª≠u th·∫ßn ƒëang g·ªçi t√™n!",
        "Quay tay v·∫≠n may s·∫Ω ƒë·∫øn (ho·∫∑c kh√¥ng).",
        "T·ª± tin l√™n, c√πng l·∫Øm l√†... x·ªâu t·∫°i ch·ªó!"
    ];

    const drinkJokes = [
        "R∆∞·ª£u b·∫•t kh·∫£ √©p, nh∆∞ng √©p th√¨ ph·∫£i u·ªëng!",
        "Th√™m m·ªôt ch√©n, ƒë·ªùi th√™m vui (ho·∫∑c th√™m ph√™).",
        "ƒê·ª´ng tr√°ch v√≤ng quay, h√£y tr√°ch b·∫°n qu√° ƒëen!",
        "U·ªëng ƒëi cho qu√™n h·∫øt s·ª± ƒë·ªùi...",
        "B·∫£n lƒ©nh n·∫±m ·ªü ƒë√°y ly, c·ªë l√™n anh em!",
        "R∆∞·ª£u n√†y th∆°m qu√°, kh√¥ng u·ªëng h∆°i ph√≠!",
        "M·ªôt ch√©n n√†y, c·∫£ b√†n ghi c√¥ng!"
    ];

    const moneyJokes = [
        "Ti·ªÅn l√† ph√π du, nh∆∞ng n·ªôp qu·ªπ l√† nghƒ©a v·ª•!",
        "T√∫i ti·ªÅn kh√≥c, nh∆∞ng qu·ªπ c∆∞·ªùi.",
        "C·∫£m ∆°n v√¨ s·ª± ƒë√≥ng g√≥p vƒ© ƒë·∫°i c·ªßa b·∫°n!",
        "V√≠ m·ªèng ƒëi m·ªôt ch√∫t, nh∆∞ng t√¨nh anh em d√†y th√™m."
    ];

    let fund = 200, drinkStats = {}, nameBag = [], giftBag = [], rotN = 0, rotG = 0;

    // --- LOGIC ---
    function init() {
        names.forEach(n => drinkStats[n] = 0);
        fillBags();
        draw('cvName', names);
        draw('cvGift', gifts);
        updateUI();
        // Hi·ªáu ·ª©ng ƒë·ªïi text h√†i h∆∞·ªõc li√™n t·ª•c
        setInterval(() => {
            if(!document.getElementById('spinBtn').disabled) {
                document.getElementById('intro-text').innerText = introJokes[Math.floor(Math.random()*introJokes.length)];
            }
        }, 3000);
    }

    function fillBags() {
        nameBag = []; names.forEach(n => { nameBag.push(n); nameBag.push(n); });
        giftBag = []; gifts.forEach(g => { for(let i=0; i<g.weight; i++) giftBag.push(g); });
        nameBag.sort(() => Math.random() - 0.5);
        giftBag.sort(() => Math.random() - 0.5);
    }

    function spin() {
        const btn = document.getElementById('spinBtn');
        btn.disabled = true;
        document.getElementById('intro-text').innerText = "üåÄ S·ªë ph·∫≠n ƒëang ƒë∆∞·ª£c quy·∫øt ƒë·ªãnh...";
        document.getElementById('result-display').innerHTML = "";

        if(!nameBag.length || !giftBag.length) fillBags();
        const pName = nameBag.pop();
        const pGift = giftBag.pop();

        const nIdx = names.indexOf(pName);
        const gIdx = gifts.findIndex(g => g.label === pGift.label);
        const nSlice = 360/names.length, gSlice = 360/gifts.length;
        const rand = 360 * 6;

        rotN = (rotN - (rotN%360)) + rand + (270 - (nIdx*nSlice) - nSlice/2);
        rotG = (rotG - (rotG%360)) + rand + (270 - (gIdx*gSlice) - gSlice/2);

        document.getElementById('cvName').style.transform = `rotate(${rotN}deg)`;
        document.getElementById('cvGift').style.transform = `rotate(${rotG}deg)`;

        setTimeout(() => {
            if(pGift.val > 0) drinkStats[pName] += pGift.val;
            fund += pGift.fund;
            if(fund < 0) fund = 0;

            let joke = "";
            if(pGift.val > 0) joke = drinkJokes[Math.floor(Math.random()*drinkJokes.length)];
            else if(pGift.fund !== 0) joke = moneyJokes[Math.floor(Math.random()*moneyJokes.length)];
            else joke = "Tho√°t n·∫°n ngo·∫°n m·ª•c!";

            document.getElementById('result-display').innerHTML = `
                <div class="res-name">${pName}</div>
                <div class="res-gift">${pGift.label} ${pGift.fund < 0 ? 'üßß' : 'üç∫'}</div>
                <div class="res-joke">"${joke}"</div>
            `;
            
            updateUI();
            btn.disabled = false;
        }, 4100);
    }

    // --- UI ---
    function draw(id, items) {
        const cv = document.getElementById(id);
        const ctx = cv.getContext('2d');
        const arc = 2 * Math.PI / items.length;
        cv.width = 600; cv.height = 600;
        items.forEach((it, i) => {
            const ang = i * arc;
            ctx.beginPath(); ctx.moveTo(300, 300); ctx.arc(300, 300, 295, ang, ang+arc);
            ctx.fillStyle = (typeof it === 'string') ? (i%2?'#1f242d':'#2a303c') : it.color;
            ctx.fill(); ctx.stroke();
            ctx.save(); ctx.translate(300, 300); ctx.rotate(ang + arc/2);
            ctx.textAlign = "right"; ctx.fillStyle = "#fff"; ctx.font = "bold 32px Arial";
            let txt = (typeof it === 'string') ? it : it.label;
            ctx.fillText(txt, 270, 10); ctx.restore();
        });
    }

    function updateUI() {
        document.getElementById('fundVal').innerText = fund;
        let html = "";
        Object.entries(drinkStats).sort((a,b)=>b[1]-a[1]).forEach(([n,v],i) => {
            html += `<div style="display:flex;justify-content:space-between;padding:8px;border-bottom:1px solid #333">
                <span>${i+1}. ${n}</span> <span style="color:var(--gold)">${v} ch√©n</span>
            </div>`;
        });
        document.getElementById('ranking').innerHTML = html;
    }

    function toggleMenu() {
        const m = document.getElementById('menuModal');
        m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
    }

    function editPlayers() {
        let val = prompt("Nh·∫≠p t√™n, ph·∫©y:", names.join(","));
        if(val) {
            names = val.split(",").map(x=>x.trim()).filter(x=>x);
            init();
        }
    }

    window.onload = () => {
        init();
        document.getElementById('spinBtn').onclick = spin;
    };
</script>
</body>
</html>
